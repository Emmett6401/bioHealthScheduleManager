# 학생 면담 관리 시스템

## 📋 개요

KDT 교육 관리 시스템에 학생 면담 관리 기능이 추가되었습니다. 이 기능을 통해 학생들과의 면담 내용을 체계적으로 기록하고, AI를 활용하여 전문적인 면담일지를 생성할 수 있습니다.

## ✨ 주요 기능

### 1. 면담 정보 관리
- **면담 기록 저장**: 일시, 장소, 주제, 내용 등 상세 정보 저장
- **면담 유형 분류**: 정기, 수시, 긴급, 학부모 면담 구분
- **사진 첨부**: 면담 시 촬영한 사진 첨부 및 관리
- **다음 면담 예정일**: 주기적 면담을 위한 예정일 설정

### 2. 면담 검색 및 조회
- **다양한 검색 옵션**: 학생명, 주제, 상담사, 면담 유형으로 검색
- **기간별 필터링**: 특정 기간의 면담 기록 조회
- **예정 면담 알림**: 다가오는 면담 일정 확인

### 3. AI 면담일지 생성 (GPT API)
- **자동 면담일지 작성**: GPT-4를 활용하여 상세한 면담일지 자동 생성
- **다양한 작성 스타일**: 공식적, 친근함, 상세 분석 중 선택
- **전문적인 구성**: 면담 개요, 학생 상태 분석, 향후 지도 방안 등 체계적 구성

### 4. 면담일지 출력
- **인쇄 기능**: 직접 프린터로 출력
- **PDF 저장**: 디지털 문서로 저장 및 공유
- **텍스트 저장**: 텍스트 파일로 저장

## 🗄️ 데이터베이스 구조

### consultations 테이블
```sql
- id: 면담 ID (자동 증가)
- student_id: 학생 ID (외래키)
- consultation_date: 면담 일시
- location: 면담 장소
- main_topic: 주요 주제
- content: 면담 내용
- consultant_name: 상담사 이름
- next_consultation_date: 다음 면담 예정일
- consultation_type: 면담 유형 (정기/수시/긴급/학부모)
- status: 상태 (예정/완료/취소)
- created_at: 생성일시
- updated_at: 수정일시
```

### consultation_photos 테이블
```sql
- id: 사진 ID (자동 증가)
- consultation_id: 면담 ID (외래키)
- photo_path: 사진 파일 경로
- photo_description: 사진 설명
- uploaded_at: 업로드 일시
```

## 🚀 설치 및 설정

### 1. 데이터베이스 테이블 생성

```bash
cd /home/user/webapp
python create_consultation_tables.py
```

이 스크립트는 다음을 수행합니다:
- `consultations` 테이블 생성
- `consultation_photos` 테이블 생성
- 필요한 인덱스 및 외래키 설정

### 2. 필요한 패키지 설치

```bash
cd /home/user/webapp/pyqt5_app
pip install -r requirements.txt
```

주요 추가 패키지:
- `openai>=1.0.0`: GPT API 사용을 위한 라이브러리

### 3. OpenAI API 키 설정

#### 방법 1: 환경 변수 설정 (권장)
```bash
# Windows
set OPENAI_API_KEY=your-api-key-here

# Linux/Mac
export OPENAI_API_KEY=your-api-key-here
```

#### 방법 2: config.py 파일 수정
```python
# pyqt5_app/config.py
OPENAI_API_KEY = "your-api-key-here"
```

## 📖 사용 방법

### 1. 면담 관리 화면 열기

프로그램 실행 후:
1. 상단 메뉴에서 `과정 관리` → `학생 면담 관리` 선택
2. 면담 관리 화면이 탭으로 열림

### 2. 새 면담 기록 작성

1. **새 면담** 버튼 클릭
2. 면담 정보 입력:
   - 학생 선택
   - 면담 일시 설정
   - 면담 장소 입력
   - 면담 유형 선택
   - 상담사 이름 입력
   - 주요 주제 입력
   - 면담 내용 작성 (상세하게)
3. (선택) 다음 면담 예정일 설정
4. (선택) 사진 추가
5. **저장** 버튼 클릭

### 3. 면담 기록 조회 및 수정

1. 왼쪽 면담 목록에서 조회할 면담 클릭
2. 오른쪽에 상세 정보 표시
3. 필요시 내용 수정 후 **저장**

### 4. 면담 검색

1. 검색창에 키워드 입력 (학생명, 주제, 상담사 등)
2. 면담 유형 선택 (전체/정기/수시/긴급/학부모)
3. 기간 설정 (시작일 ~ 종료일)
4. 자동으로 필터링된 결과 표시

### 5. AI 면담일지 생성

1. 저장된 면담 기록 선택
2. **면담일지 출력** 버튼 클릭
3. 출력 옵션 선택:
   - 작성 스타일: 공식적 / 친근함 / 상세 분석
   - 첨부 사진 포함 여부
4. **AI 면담일지 생성** 버튼 클릭
5. 생성 완료 후 미리보기 확인
6. 필요한 형식으로 저장:
   - **인쇄**: 프린터로 직접 출력
   - **PDF 저장**: PDF 파일로 저장
   - **텍스트 저장**: TXT 파일로 저장

### 6. 예정 면담 확인

1. **예정 면담** 버튼 클릭
2. 다음 면담이 예정된 학생 목록 표시
3. 해당 학생을 클릭하여 상세 정보 확인

## 🎨 AI 면담일지 예시

AI가 생성하는 면담일지는 다음과 같은 구조로 작성됩니다:

```
=== AI 생성 학생 면담일지 ===

【기본 정보】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
학생명: 홍길동 (S-001)
면담 일시: 2024년 10월 29일 14:00
면담 장소: 상담실
면담 유형: 정기
상담사: 김상담
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 면담 개요
[AI가 면담의 목적과 배경을 요약]

2. 학생 상태 분석
[현재 학생의 학습 상태, 태도, 정서 상태 분석]

3. 주요 논의 사항
[면담 중 다룬 핵심 내용 정리]

4. 학생 의견 및 반응
[학생이 표현한 생각과 감정 기록]

5. 상담사 소견
[전문적인 관찰과 평가]

6. 향후 지도 방안
[구체적인 지도 계획 및 개선 방향 제시]

7. 특이사항
[주목할 만한 특별한 사항]

8. 후속 조치
[다음 면담까지 필요한 조치사항]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
작성일: 2024년 10월 29일
생성 방식: AI 기반 자동 생성
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 📁 파일 구조

```
pyqt5_app/
├── ui/
│   ├── consultation_dialog.py           # 면담 관리 메인 다이얼로그
│   └── consultation_report_dialog.py    # 면담일지 생성 및 출력 다이얼로그
├── database/
│   └── db_manager.py                    # 면담 관련 DB 메서드 추가됨
├── config.py                             # OpenAI API 키 설정
└── requirements.txt                      # 필요 패키지 목록

consultation_photos/                      # 면담 사진 저장 디렉토리 (자동 생성)
```

## ⚠️ 주의사항

### OpenAI API 사용
- GPT-4 API는 유료 서비스입니다
- API 키를 안전하게 관리하세요 (config.py는 .gitignore에 포함)
- API 사용량에 따라 비용이 발생할 수 있습니다

### 사진 저장
- 사진은 `consultation_photos` 디렉토리에 저장됩니다
- 대용량 사진은 자동으로 압축되지 않으므로 필요시 사전 처리 권장
- 정기적으로 불필요한 사진 정리 권장

### 데이터 백업
- 정기적으로 데이터베이스 백업 수행
- 중요한 면담 기록은 PDF로 별도 저장 권장

## 🔧 문제 해결

### OpenAI API 오류
```
오류: OpenAI API 키가 설정되어 있지 않습니다
해결: 환경 변수 또는 config.py에 API 키 설정
```

### 패키지 설치 오류
```bash
# openai 패키지 수동 설치
pip install openai --upgrade
```

### 데이터베이스 연결 오류
```
오류: 데이터베이스 연결 실패
해결: config_db.py의 데이터베이스 설정 확인
```

### 사진 저장 오류
```
오류: 사진 저장 실패
해결: 
1. consultation_photos 디렉토리 권한 확인
2. 디스크 용량 확인
3. 파일 경로에 특수문자 있는지 확인
```

## 🔄 향후 개선 계획

1. **알림 기능**: 다음 면담 예정일 자동 알림
2. **통계 기능**: 학생별 면담 이력 통계 및 그래프
3. **템플릿 기능**: 자주 사용하는 면담 주제 템플릿
4. **학부모 연동**: 학부모에게 면담 결과 자동 전송
5. **다국어 지원**: 면담일지 영문 생성 지원
6. **음성 녹음**: 면담 내용 음성 녹음 및 텍스트 변환

## 📞 문의 및 지원

기능 개선 제안이나 버그 리포트는 개발팀에 문의하세요.

---

**버전**: 1.0.0  
**마지막 업데이트**: 2024-10-29  
**개발**: KDT 교육 관리 시스템 팀
