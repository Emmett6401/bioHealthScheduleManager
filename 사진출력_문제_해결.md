# 📷 사진 출력 문제 해결!

## 🐛 문제

면담일지에 **학생 사진이 출력되지 않음**

## 🔍 원인

**상대 경로 문제**:
- 기존 코드: `student_photos/thumbnails/{학번}.jpg`
- `pyqt5_app` 폴더에서 실행 시 → 프로젝트 루트의 `student_photos` 폴더를 찾지 못함
- 경로: `D:\DEV\bioHealthScheduleManager\pyqt5_app\student_photos` (존재하지 않음!)
- 올바른 경로: `D:\DEV\bioHealthScheduleManager\student_photos`

## ✅ 해결 방법

### 자동 경로 계산
```python
# 프로젝트 루트 디렉토리 자동 찾기
current_dir = os.path.dirname(os.path.abspath(__file__))  # ui 폴더
pyqt5_app_dir = os.path.dirname(current_dir)  # pyqt5_app 폴더
project_root = os.path.dirname(pyqt5_app_dir)  # 프로젝트 루트

# 절대 경로로 사진 찾기
thumbnail_path = os.path.join(project_root, "student_photos", "thumbnails", f"{학번}.jpg")
```

### 경로 확인 로그 추가
```
🔍 사진 찾는 중: D:\DEV\bioHealthScheduleManager\student_photos\thumbnails\S2024001.jpg
✅ 썸네일 발견!
✅ 사진 인코딩 완료 (크기: 15234 bytes)
```

## 🚀 지금 바로 업데이트

### Windows PowerShell:

```powershell
cd D:\DEV\bioHealthScheduleManager
git pull origin student
python pyqt5_app\main_kdt_full.py
```

## 📊 사진 찾기 순서

1. **썸네일 우선**
   - 경로: `프로젝트루트/student_photos/thumbnails/{학번}.jpg`
   - 크기: 150x180 (최적화됨)
   - ✅ 가장 빠른 로딩

2. **원본 이미지**
   - 경로: `프로젝트루트/student_photos/originals/{학번}.jpg`
   - 크기: 원본 크기
   - ✅ 고화질

3. **기본 아바타**
   - 경로: `프로젝트루트/student_photos/default_avatar.png`
   - 사진이 없는 경우
   - ✅ 항상 표시됨

## 🔍 디버깅 로그 확인

터미널에서 프로그램 실행 후 면담일지 생성 시 다음과 같은 로그가 표시됩니다:

### 성공적인 경우:
```
🔍 사진 찾는 중: D:\DEV\bioHealthScheduleManager\student_photos\thumbnails\S2024001.jpg
✅ 썸네일 발견: D:\DEV\bioHealthScheduleManager\student_photos\thumbnails\S2024001.jpg
✅ 사진 인코딩 완료 (크기: 15234 bytes)
```

### 썸네일이 없는 경우:
```
🔍 사진 찾는 중: D:\DEV\bioHealthScheduleManager\student_photos\thumbnails\S2024001.jpg
⚠️ 썸네일 없음, 원본 확인 중...
✅ 원본 사진 발견: D:\DEV\bioHealthScheduleManager\student_photos\originals\S2024001.jpg
✅ 사진 인코딩 완료 (크기: 145678 bytes)
```

### 사진이 전혀 없는 경우:
```
🔍 사진 찾는 중: D:\DEV\bioHealthScheduleManager\student_photos\thumbnails\S2024001.jpg
⚠️ 썸네일 없음, 원본 확인 중...
⚠️ 원본도 없음, 기본 아바타 사용
✅ 사진 인코딩 완료 (크기: 8234 bytes)
```

### 오류가 발생한 경우:
```
🔍 사진 찾는 중: D:\DEV\bioHealthScheduleManager\student_photos\thumbnails\S2024001.jpg
❌ 사진 로드 오류: [Errno 2] No such file or directory: '...'
```

## 📁 폴더 구조 확인

프로젝트 루트에 다음 폴더 구조가 있어야 합니다:

```
D:\DEV\bioHealthScheduleManager\
├── pyqt5_app\
│   ├── main_kdt_full.py
│   └── ui\
│       └── consultation_report_dialog.py
└── student_photos\              ← 이 폴더가 있어야 함!
    ├── thumbnails\               ← 썸네일 저장
    │   ├── S2024001.jpg
    │   └── S2024002.jpg
    ├── originals\                ← 원본 저장
    │   ├── S2024001.jpg
    │   └── S2024002.jpg
    └── default_avatar.png        ← 기본 아바타
```

## ✅ 폴더 생성 (없는 경우)

```bash
# PowerShell에서 실행
cd D:\DEV\bioHealthScheduleManager
mkdir student_photos\thumbnails
mkdir student_photos\originals
```

또는 Windows 탐색기에서:
1. `D:\DEV\bioHealthScheduleManager` 폴더 열기
2. `student_photos` 폴더 생성
3. 그 안에 `thumbnails`, `originals` 폴더 생성

## 🎯 테스트 방법

### 1. 학생 사진 등록

1. **학생 관리** → **학생 정보**
2. 학생 선택
3. **"📷 사진 등록"** 버튼 클릭
4. 사진 파일 선택 (JPG, PNG, GIF)
5. 자동 저장 완료!

### 2. 면담일지 생성 (사진 포함)

1. **학생 관리** → **학생 면담 관리**
2. 면담 기록 선택
3. **"📝 면담일지 생성 (무료)"** 버튼 클릭
4. 터미널에서 로그 확인:
   ```
   🔍 사진 찾는 중: ...
   ✅ 사진 발견: ...
   ```
5. 면담일지에 사진이 표시되는지 확인!

### 3. PDF 저장 테스트

1. **"PDF 저장"** 버튼 클릭
2. 파일 저장
3. PDF 파일 열어서 사진 포함 여부 확인

## 🐛 문제 해결

### 사진이 여전히 안 보이는 경우

#### 1. 폴더 경로 확인
```powershell
# PowerShell에서 실행
cd D:\DEV\bioHealthScheduleManager
dir student_photos
```

예상 출력:
```
    디렉터리: D:\DEV\bioHealthScheduleManager\student_photos

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----         2024-10-29   오후 2:30                thumbnails
d-----         2024-10-29   오후 2:30                originals
-a----         2024-10-29   오후 2:30           8234 default_avatar.png
```

#### 2. 학생 사진 파일 확인
```powershell
dir student_photos\thumbnails
dir student_photos\originals
```

학번과 파일명이 일치하는지 확인!
- 예: 학번 `S2024001` → 파일명 `S2024001.jpg`

#### 3. 로그 확인

터미널에서 실행하고 로그 확인:
```powershell
python pyqt5_app\main_kdt_full.py
```

면담일지 생성 시 출력되는 로그를 확인하세요!

#### 4. 기본 아바타 없는 경우

`student_photos/default_avatar.png` 파일이 없으면 생성:
- 아무 이미지 파일을 `default_avatar.png`로 저장
- 또는 GitHub에서 다운로드:
  ```powershell
  # (이미 포함되어 있어야 함)
  git pull origin student
  ```

## 📦 변경된 파일

- `pyqt5_app/ui/consultation_report_dialog.py`
  - `get_student_photo_base64()` 메서드 수정
  - 상대 경로 → 절대 경로
  - 디버깅 로그 추가

## 🎉 최종 결과

✅ **사진 경로 문제 해결!**  
✅ **절대 경로로 안정적 동작!**  
✅ **플랫폼 독립적 경로!** (Windows/Linux/Mac)  
✅ **상세한 디버깅 로그!**  
✅ **썸네일 → 원본 → 기본 아바타 자동 선택!**

이제 **면담일지에 학생 사진이 정상적으로 표시**됩니다! 📷✨

## 💡 추가 팁

### 고화질 사진 원하는 경우
- 썸네일 폴더에서 파일 삭제
- 원본만 남기면 원본 사진 사용 (더 큰 파일 크기)

### 빠른 로딩 원하는 경우
- 썸네일 사용 (150x180, 최적화됨)
- 학생 정보에서 사진 등록 시 자동 생성됨

### 모든 학생에게 같은 기본 이미지
- `student_photos/default_avatar.png` 교체
- 원하는 이미지로 변경 가능

---

문제가 계속되면 터미널 로그를 캡처해서 알려주세요! 🔍
